{% extends 'layout/base.html' %}
{% load i18n humanize desparchado_tags django_vite %}

{% block title %}{{ event.title }}{% endblock %}

{% block meta %}
  <meta property="og:title" content="{{ event.title }}">
  <meta property="og:description" content="{{ event.place }}">
  <meta property="og:image" content="https://desparchado.co{{ event.get_image_url }}">

  <meta name="twitter:title" content="{{ event.title }}">
  <meta name="twitter:description" content="{{ event.place.name }}">
{% endblock %}

{% block google-structured-markup %}
<!-- JSON-LD markup generated by Google Structured Data Markup Helper. -->
<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Event",
  "name" : "{{ event.title }}",
  "startDate" : "{{ event.event_date|date:'c' }}",
  "location" : {
    "@type" : "Place",
    "name" : "{{ event.place.name }}",
    "address" : "{{ event.place.description }}"
  },
  "image" : "https://desparchado.co{{ event.get_image_url }}"
}
</script>
{% endblock %}

{% block extra_scripts %}
  {% vite_asset 'desparchado/frontend/scripts/mount-vue.ts' %}
  {% vite_asset 'desparchado/frontend/scripts/home.ts' %}

  <script
      src="https://maps.googleapis.com/maps/api/js?key={{ GOOGLE_MAPS_API_KEY }}&libraries=maps,marker"
      defer
  ></script>
{% endblock extra_scripts %}

{% block content %}
  <section class="event-details">
    <div class="event-details__image">
      <img class="event-details__image" alt="{{ event.title }}" src="{{ event.get_image_url }}" />
    </div>
    <div class="event-details__container">
      <div class="event-details__details">
        <div class="event-details__info excluded-from-mobile">
          {% if event.place.name %}
            <span class="event-details__info-item text-body-md">
              {{ event.place.name }}
            </span>
          {% endif %}
          <span class="event-details__info-item text-body-md">
            / {{ event.place.description|safe }}
          </span>
          {% if event.place.city.name %}
            <span class="event-details__info-item text-body-md">
              / {{ event.place.city.name }}
            </span>
          {% endif %}
          {% if event.event_date|naturalday != event.event_date|date %}
            <span class="event-details__info-item text-body-md">
               / {{ event.event_date|naturalday }}
            </span>
          {% endif %}
          <span class="event-details__info-item text-bold text-body-md">
            / {{ event.event_date|date:"l, d M H:i" }}
          </span>
          {% if event.price %}
            <span class="event-details__info-item text-body-md text-bold">
            / {{ event.get_price_display }}
            </span>
          {% endif %}
        </div>
        <div class="event-details__header">
          <div class="event-details__title-section">
            <p class="event-details__title text-heading-3">{{ event.title }}</p>
            <div class="event-details__date excluded-from-desktop">
              <span class="text-body-highlight text-bold">
                {{ event.event_date|date:'j M' }}
              </span>
              <span class="text-body-highlight text-medium">
                 {{ event.event_date|date:'H:i' }}
              </span>
            </div>
          </div>
          <span class="text-heading-5 excluded-from-desktop">{{ event.place.name }}, {{ event.place.description|safe }}, {{ event.place.city.name }}</span>
          {% if event.price %}
            <span class="text-heading-5 excluded-from-desktop">
              {{ event.get_price_display }}
            </span>
          {% endif %}          
          <div class="event-details__mobile-actions excluded-from-desktop">
            <div
              data-vue-component="button"
              data-vue-prop-type="secondary"
              data-vue-prop-label=" {% translate 'Ir al sitio del evento' %}"
              data-vue-prop-icon="world-40"
              data-vue-prop-link="{{ event.get_absolute_url }}"
            >
            </div>
          </div>
        </div>
        <div class="event-details__content">
          {% if event.speakers.exists %}
            <div class="speakers">
              <div class="speakers__avatar-container">
                {% for speaker in event.speakers.all %}
                  <a href="{{ speaker.get_absolute_url }}">
                    <img class="speakers__avatar" src="{{ speaker.get_image_url }}" alt="{{ speaker.name }}" />
                  </a>
                {% endfor %}
              </div>
              <p class="text-heading-5">
                {{ speaker.name }}{% if not forloop.last %}{% if forloop.revcounter == 2 %} {% translate 'y' %} {% else %}, {% endif %}{% else %}{% endif %}
              </p>
            </div>
          {% endif %}

          <p class="text-body-md event-details__description">
            <span class="text-body-md text-bold">
              {% translate 'Sobre el evento' %}:
              </br></br>
            </span>
            {{ event.description|safe|linebreaksbr }}
          </p>

          {% if event.speakers.exists %}
            <div class="event-details__item-list">
              <h2 class="text-heading-4">Presentadores</h2>
              <div class="event-details__item-list-list">
                {% for speaker in event.speakers.all %}
                  <div class="event-details__item-list-item">
                    <a href="{{ speaker.get_absolute_url }}">
                      <img class="event-details__item-list-item-image" height="170" src="{{ speaker.get_image_url }}" alt="{{ speaker.name }}">
                    </a>
                    <div class="event-details__item-list-item-details">
                      <p class="text-heading-4">{{ speaker.name }}</p>
                      <p class="text-caption">{{ speaker.description|safe|linebreaksbr|truncatewords_html:50 }}</p>
                    </div>
                  </div>
                {% endfor %}
              </div>
            </div>
          {% endif %}

          <div class="event-details__item-list">
            <h2 class="text-heading-4">Organizador{{ organizers|pluralize:'es' }}</h2>
            <div class="event-details__item-list-list">
              {% for organizer in organizers %}
                <div class="event-details__item-list-item">
                  <a href="{{ organizer.get_absolute_url }}">
                    <img class="event-details__item-list-item-image" height="170" src="{{ organizer.get_image_url }}" alt="{{ organizer.name }}">
                  </a>
                  <div class="event-details__item-list-item-details">
                    <p class="text-heading-4">{{ organizer.name }}</p>
                    <p class="text-caption">{{ organizer.description|safe|linebreaksbr|truncatewords_html:50 }}</p>
                  </div>
                </div>
              {% endfor %}
            </div>
          </div>

        </div>
      </div>
      <div class="event-details__actions excluded-from-mobile">
        {% for organizer in organizers %}
          <div class="event-details__actions-image">
            <a href="{{ organizer.get_absolute_url }}">
              <img src="{{ organizer.get_image_url }}" alt="{{ organizer.name }}">
            </a>
          </div>
        {% endfor %}
        <div
          class="event-details__action"
          data-vue-component="button"
          data-vue-prop-type="tertiary"
          data-vue-prop-name="{% translate 'Ver mapa' %}"
          data-vue-prop-icon="pin-40"
          data-vue-prop-padding="balanced"
          data-vue-prop-link="#event-place-map"
        >
        </div>
        <div
          class="event-details__action"
          data-vue-component="button"
          data-vue-prop-type="tertiary"
          data-vue-prop-name="Ir al sitio del evento"
          data-vue-prop-icon="world-40"
          data-vue-prop-padding="balanced"
          data-vue-prop-link="{{ event.get_absolute_url }}"
        >
        </div>
      </div>
    </div>
  </section>
  
  <div class="event-details__additional event-details__additional--stroke">
    <div class="event-details__additional-children event-details__map">
      <div style="width: 513px; width: 100%" class="event-details__map-widget">
        <gmp-map
          center="{{ event.get_latitude_str }},{{ event.get_longitude_str }}"
          zoom="15"
          map-id="place-map"
          style="height: 250px; width: auto"
        >
          <gmp-advanced-marker
            position="{{ event.get_latitude_str }},{{ event.get_longitude_str }}"
            title="{{ event.title }}"
          ></gmp-advanced-marker>
        </gmp-map>
      </div>
    
      <div class="event-details__map-details">
        <span class="text-heading-5">{{ event.place.description|safe }}</span>
        <span class="text-heading-4 text-bold">{{ event.place.name }}</span>
        <div
          data-vue-component="button"
          data-vue-prop-type="secondary"
          data-vue-prop-label=" {% translate 'Ver otros eventos en este sitio' %}"
          data-vue-prop-link="{{ event.place.get_absolute_url }}"
        >
        </div>
      </div>
    </div>
  </div>

  <div class="event-details__additional event-details__additional--stroke">
    <div class="event-details__additional-children">
      {# Grupo del evento #}
      {% for special in event.specials.all %}
      <div>
        <div style="color: red">{% translate 'Este evento pertenece a:' %}</div>
        <div>{{ special.title }}</div>
        <img src="{{ special.get_image_url }}" height="50" alt="{{ special.title }}"></a>
        <div>{{ special.subtitle }}</div>
        <div><a href="{{ special.get_absolute_url }}">{% translate 'Ver evento' %}</a></div>
      </div>
      {% endfor %}
    </div>
  </div>

  {% if related_events %}
    <section>
      <div class="intro-section">
        <div class="main-title">
          <div
            data-vue-component="typography"
            data-vue-prop-text="{% translate 'Otros parecidos' %}"
            data-vue-prop-type="h2"
          >
          </div>
        </div>
        <div class="featured-events">
        {% for related_event in related_events %}
          <div
            class="featured-events__item"
            data-vue-component="featured-event-card"
            data-vue-prop-tag="div"
            data-vue-prop-location="{{ related_event.place.name }}"
            data-vue-prop-title="{{ related_event.title }}"
            data-vue-prop-day="{{ related_event.event_date|date:'j M' }}"
            data-vue-prop-time="{{ related_event.event_date|date:'H:i' }}"
            data-vue-prop-image-url="{{ related_event.get_image_url }}"
          >
          </div>
        {% endfor %}
        </div>
      </div>
    </section>
  {% endif %}

  {# Dónde lo ponemos? #}
  {# No sabría donde poner esto, no sé que es #}
  {% if event.image_source_url %}{{ event.image_source_url }}{% endif %}

{% endblock content %}


