{% extends 'layout/base.html' %}
{% load i18n desparchado_tags django_vite %}

{% block title %}Eventos en {{ place.name }}{% endblock %}

{% block extra_scripts %}
  {% vite_asset 'desparchado/frontend/scripts/generic.ts' %}
{% endblock extra_scripts %}

{% block google-structured-markup %}
<!-- JSON-LD markup generated by Google Structured Data Markup Helper. -->
<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Place",
  "name" : "{{ place.name }}",
  "address": {
    "@type": "PostalAddress",
    "streetAddress": "{{ place.address }}",
    "addressLocality": "{{ place.city.name }}",
    "addressCountry": "CO"
  },
  "geo": {
    "@type": "GeoCoordinates",
    "latitude": "{{ place.get_latitude_str }}",
    "longitude": "{{ place.get_longitude_str }}"
  }
}
</script>
{% endblock %}

{% block content %}
<div id="place-detail" class="generic-detail">
  <section class="place-heading">
    <h1 class="place-title">{{ place.name }}</h1>

    {% if place.image %}
      <img class="place-image" src="{{ place.get_image_url }}" alt="{{ place.name }}" />
    {% endif %}

    <div class="place-description">{{ place.address }}</div>

  {% if user|user_can_edit_place:place %}
    <div
      data-vue-component="button"
      data-vue-prop-type="secondary"
      data-vue-prop-label="{% translate 'Editar' %}"
      data-vue-prop-link="{% url 'places:place_update' place.pk %}"
    >
    </div>
  {% endif %}
  </section>

  {% include 'includes/_map.html' with title=place latitude=place.get_latitude_str longitude=place.get_longitude_str css_class='place-map generic-detail__map' %}

  {% if events %}
    <section class="generic-detail__section">
      <div class="generic-detail__section-header generic-detail__section-header--padding-sm">
        <div
          class="generic-detail__section-title"
          data-vue-component="typography"
          data-vue-prop-text="Pronto se presentará aquí"
          data-vue-prop-type="h2"
        >
        </div>
      </div>
      <div class="events-list">
        {% for event in events %}
          <div
            class="events-list__card"
            data-vue-component="event-card"
            data-vue-prop-tag="div"
            data-vue-prop-location="{{ event.place.name }}"
            data-vue-prop-description="{{ event.description }}"
            data-vue-prop-title="{{ event.title }}"
            data-vue-prop-day="{{ event.event_date|date:'j M' }}"
            data-vue-prop-time="{{ event.event_date|date:'H:i' }}"
            data-vue-prop-image-url="{{ event.get_image_url }}"
            data-vue-prop-link="{{ event.get_absolute_url }}"
            data-vue-prop-date-copy="{{ event.event_date|date:'l' }}"
            data-vue-prop-speakers='[{% with speakers=event.speakers.all %}{% if speakers %}{% for speaker in speakers %}{"imageUrl": "{{ speaker.get_image_url|escapejs }}", "link": "{{ speaker.get_absolute_url|escapejs }}", "name": "{{ speaker.name|escapejs }}" }{% if not forloop.last %}, {% endif %}{% endfor %}{% endif %}{% endwith %}]'
          </div>
        {% endfor %}
      </div>
    </section>
  {% endif %}
  
  {% if past_events %}
    <section class="generic-detail__section">
      <div class="generic-detail__section-header generic-detail__section-header--padding-lg">
        <div
          class="generic-detail__section-title"
          data-vue-component="typography"
          data-vue-prop-text="Archivo"
          data-vue-prop-type="h2"
        >
        </div>
        <div
          data-vue-component="typography"
          data-vue-prop-text="Otros eventos que se han presentado en {{ place.name }}"
          data-vue-prop-type="body_lg"
        >
        </div>
      </div>
      <div class="generic-detail__events-list-full-width">
        {% for event in past_events %}
          <div
            data-vue-component="event-card-full-width"
            data-vue-prop-tag="div"
            data-vue-prop-location="{{ event.place.name }}"
            data-vue-prop-description="{{ event.description }}"
            data-vue-prop-title="{{ event.title }}"
            data-vue-prop-day="{{ event.event_date|date:'j M' }}"
            data-vue-prop-time="{{ event.event_date|date:'H:i' }}"
            data-vue-prop-image-url="{{ event.get_image_url }}"
            data-vue-prop-link="{{ event.get_absolute_url }}"
            data-vue-prop-date-copy="{{ event.event_date|date:'Y' }}"
            data-vue-prop-speakers='[{% with speakers=event.speakers.all %}{% if speakers %}{% for speaker in speakers %}{"imageUrl": "{{ speaker.get_image_url|escapejs }}", "link": "{{ speaker.get_absolute_url|escapejs }}", "name": "{{ speaker.name|escapejs }}" }{% if not forloop.last %}, {% endif %}{% endfor %}{% endif %}{% endwith %}]'
          >
          </div>
        {% endfor %}
      </div>
    </section>
  {% endif %}
</div>


{% endblock content %}
