{% extends 'layout/base.html' %}
{% load i18n humanize desparchado_tags django_vite %}

{% block title %}{{ event.title }}{% endblock %}

{% block meta %}
  <meta property="og:title" content="{{ event.title }}">
  <meta property="og:description" content="{{ event.place }}">
  <meta property="og:image" content="https://desparchado.co{{ event.get_image_url }}">

  <meta name="twitter:title" content="{{ event.title }}">
  <meta name="twitter:description" content="{{ event.place.name }}">
{% endblock %}

{% block google-structured-markup %}
<!-- JSON-LD markup generated by Google Structured Data Markup Helper. -->
<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Event",
  "name" : "{{ event.title }}",
  "startDate" : "{{ event.event_date|date:'c' }}",
  "location" : {
    "@type" : "Place",
    "name" : "{{ event.place.name }}",
    "address" : "{{ event.place.description }}"
  },
  "image" : "https://desparchado.co{{ event.get_image_url }}"
}
</script>
{% endblock %}

{% block extra_scripts %}
  {% vite_asset 'desparchado/frontend/scripts/mount-vue.ts' %}
  {% vite_asset 'desparchado/frontend/scripts/home.ts' %}

  <script
      src="https://maps.googleapis.com/maps/api/js?key={{ GOOGLE_MAPS_API_KEY }}&libraries=maps,marker"
      defer
  ></script>
{% endblock extra_scripts %}

{% block content %}

  <a href="{% url 'home' %}">{% translate 'Volver al inicio' %}</a>

  {# Header with place, address and date #}
  <div>
    <div>{{ event.place.name }}</div>
    <div>{{ event.place.description|safe }}</div>
    <div>{% if event.event_date|naturalday != event.event_date|date %}{{ event.event_date|naturalday }}{% endif %}</div>
    <div>{{ event.event_date|date:'j M' }} {{ event.event_date|date:'H:i' }}</div>
  </div>

  {# DÃ³nde lo ponemos? #}
  <div>
    <div>{{ event.place.city.name }}</div>
    <div>{% if event.price %}{{ event.get_price_display }}{% endif %}</div>
    <div>{% if event.image_source_url %}{{ event.image_source_url }}{% endif %}</div>
  </div>

  {# Image #}
  <img alt="{{ event.title }}" height="200" src="{{ event.get_image_url }}" />

  {# Title, description and speakers #}
  <div>
    <h1>{{ event.title }}</h1>
    {% if event.speakers.exists %}
    <div>
      {% for speaker in event.speakers.all %}
          <a href="{{ speaker.get_absolute_url }}"><img src="{{ speaker.get_image_url }}" height="33" alt="{{ speaker.name }}" /></a>
      {% endfor %}
      {% for speaker in event.speakers.all %}
        <i>
          {{ speaker.name }}{% if not forloop.last %}{% if forloop.revcounter == 2 %} {% translate 'y' %} {% else %}, {% endif %}{% else %}{% endif %}
        </i>
      {% endfor %}
    </div>
    {% endif %}
    <div>{{ event.description|safe|linebreaksbr }}</div>
  </div>

  {# Map #}
  <div style="width: 513px;">
    <gmp-map
      center="{{ event.get_latitude_str }},{{ event.get_longitude_str }}"
      zoom="15"
      map-id="place-map"
      style="height: 321px; width: auto"
    >
      <gmp-advanced-marker
        position="{{ event.get_latitude_str }},{{ event.get_longitude_str }}"
        title="{{ event.title }}"
      ></gmp-advanced-marker>
    </gmp-map>
  </div>

  {# Place details #}
  <div>
    <div><i>{{ event.place.description|safe }}</i></div>
    <div>{{ event.place.name }}</div>
    <div><a href="{{ event.event_source_url }}" target="_blank">{% translate 'Ir al sitio del organizador' %}</a></div>
  </div>

  {# Grupo del evento #}
  {% for special in event.specials.all %}
  <div>
    <div style="color: red">{% translate 'Este evento pertenece a:' %}</div>
    <div>{{ special.title }}</div>
    <img src="{{ special.get_image_url }}" height="50" alt="{{ special.title }}"></a>
    <div>{{ special.subtitle }}</div>
    <div><a href="{{ special.get_absolute_url }}">{% translate 'Ver evento' %}</a></div>
  </div>
  {% endfor %}

  {# Aside #}
  <div>
  {% for organizer in organizers %}
    <div>
      <a href="{{ organizer.get_absolute_url }}"><img width="120" src="{{ organizer.get_image_url }}" alt="{{ organizer.name }}"></a>
    </div>
  {% endfor %}
    <div>{% translate 'Ver mapa' %}</div>
    <div><a href="{{ event.get_absolute_url }}">{% translate 'Ir al sitio del evento' %}</a></div>
  </div>

  {# Otros parecidos #}
  <div>{% translate 'Otros parecidos' %}</div>
  <div class="featured-events">
      {% for related_event in related_events %}
        <div
          class="featured-events__item"
          data-vue-component="featured-event-card"
          data-vue-prop-tag="div"
          data-vue-prop-location="{{ related_event.place.name }}"
          data-vue-prop-title="{{ related_event.title }}"
          data-vue-prop-day="{{ related_event.event_date|date:'j M' }}"
          data-vue-prop-time="{{ related_event.event_date|date:'H:i' }}"
          data-vue-prop-image-url="{{ related_event.get_image_url }}"
        >
        </div>
      {% endfor %}
  </div>

{% endblock content %}
