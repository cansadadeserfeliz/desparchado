{% extends 'layout/base.html' %}
{% load i18n desparchado_tags django_vite %}

{% block title %}{{ event.title }}{% endblock %}

{% block bootstrap_css %}{% endblock %}

{% block meta %}
  <meta property="og:title" content="{{ event.title }}">
  <meta property="og:description" content="{{ event.place }}">
  <meta property="og:image" content="https://desparchado.co{{ event.get_image_url }}">

  <meta name="twitter:title" content="{{ event.title }}">
  <meta name="twitter:description" content="{{ event.place.name }}">
{% endblock %}

{% block google-structured-markup %}
<!-- JSON-LD markup generated by Google Structured Data Markup Helper. -->
<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Event",
  "name" : "{{ event.title }}",
  "startDate" : "{{ event.event_date|date:'c' }}",
  "location" : {
    "@type" : "Place",
    "name" : "{{ event.place.name }}",
    "address": {
      "@type" : "PostalAddress",
      "streetAddress": "{{ event.place.address }}",
      "addressLocality": "{{ event.place.city.name }}"
    }
  },
  "image" : "https://desparchado.co{{ event.get_image_url }}"
}
</script>
{% endblock %}

{% block extra_scripts %}
  {% vite_asset 'desparchado/frontend/scripts/event-details.ts' %}

  <script
      src="https://maps.googleapis.com/maps/api/js?key={{ GOOGLE_MAPS_API_KEY }}&libraries=maps,marker"
      defer
  ></script>
{% endblock extra_scripts %}

{% block content %}
  <section class="event-details">
    <div class="event-details__image" style="--">
      <img alt="{{ event.title }}" src="{{ event.get_image_url }}" />
      {% if event.image_source_url %}
        <div class="event-details__image-source text-caption">
          {% translate 'Fuente de la imagen' %}: <a href="{{ event.image_source_url }}" target="_blank">
            {{ event.image_source_url|shorten_url }}
          </a>
        </div>
      {% endif %}
    </div>
    <div class="event-details__container">
      <div class="event-details__details">
        <div class="event-details__info excluded-from-mobile">
          <span class="event-details__info-item text-body-md">
            {{ event.place.name }}
          </span>
          <span class="event-details__info-item text-body-md">
            / {{ event.place.address }}
          </span>
          {% if event.place.city %}
            <span class="event-details__info-item text-body-md">
              / {{ event.place.city.name }}
            </span>
          {% endif %}
        {% with natural_day=event.event_date|natural_day_no_default %}
          {% if natural_day %}
            <span class="event-details__info-item text-body-md">
               / {{ natural_day }}
            </span>
          {% endif %}
        {% endwith %}
          <span class="event-details__info-item text-bold text-body-md">
            / {{ event.event_date|date:"l, d M H:i, Y" }}
          </span>
          {% if event.price %}
            <span class="event-details__info-item text-body-md text-bold">
            / {{ event.get_price_display }}
            </span>
          {% endif %}
        </div>
        <div class="event-details__header">
          <div class="event-details__title-section">
            <p class="event-details__title text-heading-3">{{ event.title }}</p>
            <div class="event-details__date excluded-from-desktop">
              <span class="text-body-highlight text-bold">
                {{ event.event_date|date:'j M' }}
              </span>
              <span class="text-body-highlight text-medium">
                 {{ event.event_date|date:'H:i' }}
              </span>
            </div>
          </div>
          <div class="text-heading-5 excluded-from-desktop event-details__address-section">
            <span>{{ event.place.name }}</span>, {{ event.place.address }} {% if event.place.city.name %}, {{ event.place.city.name }}.{% endif %}
          </div>
          {% if event.price %}
            <span class="text-heading-5 excluded-from-desktop">
              {{ event.get_price_display }}
            </span>
          {% endif %}
          <div class="event-details__mobile-actions excluded-from-desktop">
            <div
              data-vue-component="button"
              data-vue-prop-type="secondary"
              data-vue-prop-label="{% translate 'Ir al sitio del evento' %}"
              data-vue-prop-icon="world-40"
              data-vue-prop-link="{{ event.event_source_url }}"
              data-vue-prop-target="_blank"
            >
            </div>
          </div>
        </div>
        <div class="event-details__content">
          {% if user|user_can_edit_event:event %}
            <div
              data-vue-component="button"
              data-vue-prop-type="secondary"
              data-vue-prop-label="{% translate 'Editar Evento' %}"
              data-vue-prop-link="{% url 'events:event_update' event.pk %}"
            >
            </div>
          {% endif %}

          {% if speakers %}
            <div class="speakers">
              <div class="speakers__avatar-container">
                {% for speaker in speakers %}
                  <a href="{{ speaker.get_absolute_url }}">
                    <img class="speakers__avatar"
                         src="{{ speaker.get_image_url }}"
                         alt="{{ speaker.name }}"
                         loading="lazy" />
                  </a>
                {% endfor %}
              </div>
              <p class="text-heading-5">
                {% for speaker in speakers %}
                  {{ speaker.name }}{% if not forloop.last %}{% if forloop.revcounter == 2 %} {% translate 'y' %} {% else %}, {% endif %}{% endif %}
                {% endfor %}
              </p>
            </div>
          {% endif %}

          <div class="text-body-md event-details__description">
            <span class="text-body-md text-bold">
              {% translate 'Sobre el evento' %}:
              </br></br>
            </span>
            {{ event.description|safe|linebreaksbr }}
          </div>
          <div class="event-details__disclaimer">
            <div
              class="event-details__disclaimer-icon"
              data-vue-component="icon"
              data-vue-prop-id="info"
              data-vue-prop-size="large"
            >
            </div>
            <p class="text-caption event-details__disclaimer-text" >
              {% blocktranslate %}
                Desparchado.co no organiza los eventos que se muestran en la plataforma.
                Somos un servicio de divulgación que recopila eventos culturales de diversas fuentes y
                las vuelve accesibles para ti. Si necesitas información o confirmación te recomendamos
                que contactes directamente a los organizadores.
              {% endblocktranslate %}
            </p>
          </div>
          {% if speakers %}
            <div class="event-details__item-list">
              <h2 class="text-heading-4">Presentadores</h2>
              <div class="event-details__item-list-list">
                {% for speaker in speakers %}
                  <div class="event-details__item-list-item">
                    <a href="{{ speaker.get_absolute_url }}">
                      <img class="event-details__item-list-item-image" height="170" src="{{ speaker.get_image_url }}" alt="{{ speaker.name }}">
                    </a>
                    <div class="event-details__item-list-item-details">
                      <p class="text-heading-4">{{ speaker.name }}</p>
                      <div class="text-caption">{{ speaker.description|safe|truncatewords_html:50 }}</div>
                      <a class="text-body-md" href="{{ speaker.get_absolute_url }}">Leer más</a>
                    </div>
                  </div>
                {% endfor %}
              </div>
            </div>
          {% endif %}

          <div class="event-details__item-list">
            <h2 class="text-heading-4">Organizador{{ organizers|pluralize:'es' }}</h2>
            <div class="event-details__item-list-list">
              {% for organizer in organizers %}
                <div class="event-details__item-list-item">
                  <a href="{{ organizer.get_absolute_url }}">
                    <img class="event-details__item-list-item-image" height="170" src="{{ organizer.get_image_url }}" alt="{{ organizer.name }}">
                  </a>
                  <div class="event-details__item-list-item-details">
                    <p class="text-heading-4">{{ organizer.name }}</p>
                    <div class="text-caption">{{ organizer.description|safe|truncatewords_html:50 }}</div>
                    <a class="text-body-md" href="{{ organizer.get_absolute_url }}">Leer más</a>
                  </div>
                </div>
              {% endfor %}
            </div>
          </div>

        </div>
      </div>
      <div class="event-details__actions excluded-from-mobile">
        {% for organizer in organizers %}
          <div class="event-details__actions-image">
            <a href="{{ organizer.get_absolute_url }}">
              <img src="{{ organizer.get_image_url }}" alt="{{ organizer.name }}">
            </a>
          </div>
        {% endfor %}
        <div
          class="event-details__action"
          data-vue-component="button"
          data-vue-prop-type="tertiary"
          data-vue-prop-name="{% translate 'Ver mapa' %}"
          data-vue-prop-icon="pin-40"
          data-vue-prop-padding="balanced"
          data-vue-prop-link="#event-place-map"
        >
        </div>
        <div
          class="event-details__action"
          data-vue-component="button"
          data-vue-prop-type="tertiary"
          data-vue-prop-name="Ir al sitio del evento"
          data-vue-prop-icon="world-40"
          data-vue-prop-padding="balanced"
          data-vue-prop-link="{{ event.event_source_url }}"
          data-vue-prop-target="_blank"
        >
        </div>
      </div>
    </div>
  </section>

  <div class="event-details__additional event-details__additional--stroke">
    <div class="event-details__additional-children event-details__map">
      <div style="width: 513px; width: 100%" class="event-details__map-widget">
        <gmp-map
          center="{{ event.get_latitude_str }},{{ event.get_longitude_str }}"
          zoom="15"
          map-id="place-map"
          style="height: 250px; width: auto"
        >
          <gmp-advanced-marker
            position="{{ event.get_latitude_str }},{{ event.get_longitude_str }}"
            title="{{ event.title }}"
          ></gmp-advanced-marker>
        </gmp-map>
      </div>

      <div class="event-details__map-details">
        <span class="text-heading-5 event-details__map-address">{{ event.place.description|safe }}</span>
        <span class="text-heading-4 text-bold">{{ event.place.name }}</span>
        <div
          data-vue-component="button"
          data-vue-prop-type="secondary"
          data-vue-prop-label="{% translate 'Ver otros eventos en este sitio' %}"
          data-vue-prop-link="{{ event.place.get_absolute_url }}"
        >
        </div>
      </div>
    </div>
  </div>

  {% if event.specials.all %}
    <div class="event-details__additional event-details__additional--stroke">
      {% for special in event.specials.all %}
        <div class="event-details__additional-children event-details__specials">
          <div class="event-details__special-item">
            <a class="event-details__special-banner-anchor" href="{{ special.get_absolute_url }}" aria-label="{% translate 'Ir al evento al que pertenece' %}: {{ special.title }}, {{ special.subtitle }}">
              <img class="event-details__special-banner" src="{{ special.get_image_url }}" aria-hidden="true" role="presentation">
            </a>
          </div>
        </div>
      {% endfor %}
    </div>
  {% endif %}

  {% if related_events %}
    <section>
      <div class="intro-section event-details__featured-events">
        <div class="main-title">
          <div
            data-vue-component="typography"
            data-vue-prop-text="{% translate 'Otros parecidos' %}"
            data-vue-prop-type="h2"
          >
          </div>
        </div>
        <div class="featured-events">
        {% for related_event in related_events %}
          <div
            class="featured-events__item"
            data-vue-component="featured-event-card"
            data-vue-prop-tag="div"
            data-vue-prop-location="{{ related_event.place.name }}"
            data-vue-prop-title="{{ related_event.title }}"
            data-vue-prop-day="{{ related_event.event_date|date:'j M' }}"
            data-vue-prop-time="{{ related_event.event_date|date:'H:i' }}"
            data-vue-prop-image-url="{{ related_event.get_image_url }}"
            data-vue-prop-link="{{ related_event.get_absolute_url }}"
            data-vue-prop-date-copy="{{ related_event.event_date|natural_day }}"
          >
          </div>
        {% endfor %}
        </div>
      </div>
    </section>
  {% endif %}



{% endblock content %}
